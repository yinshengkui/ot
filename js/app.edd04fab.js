(function(t){function e(e){for(var n,o,l=e[0],s=e[1],c=e[2],f=0,h=[];f<l.length;f++)o=l[f],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);u&&u(e);while(h.length)h.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],n=!0,l=1;l<a.length;l++){var s=a[l];0!==r[s]&&(n=!1)}n&&(i.splice(e--,1),t=o(o.s=a[0]))}return t}var n={},r={app:0},i=[];function o(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=t,o.c=n,o.d=function(t,e,a){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(a,n,function(e){return t[e]}.bind(null,n));return a},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/ot/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),r=a.n(n);r.a},"56d7":function(t,e,a){"use strict";a.r(e);a("e260"),a("e6cf"),a("cca6"),a("a79d");var n=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("h1",[t._v("Welcome to OT!")]),a("el-tabs",{staticStyle:{height:"100%"},attrs:{"tab-position":"left"},on:{"tab-click":t.handleClick},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[t._l(t.monthList,(function(e,n){return a("el-tab-pane",{attrs:{label:e,name:n+"",id:n=""}},[t._v(" "+t._s(e)+" ORK情况一览 ")])})),a("router-view")],2)],1)},i=[],o={data:function(){return{activeTab:"",monthList:[]}},methods:{handleClick:function(t){this.$router.push({path:"/okr/",query:{month:t.label}}).catch((function(){}))}},created:function(){this.activeTab="1",this.monthList=l(2019);var t=this.monthList[this.activeTab];this.$router.push({path:"/okr/",query:{month:t}}).catch((function(){}))}};function l(t){var e=function(t){return t<10?"0"+t:t+""},a=[],n=(new Date).getMonth()+3,r=(new Date).getFullYear();n>12&&(r+=1,n=1);for(var i=r;i>=t;--i){for(var o=n;o>0;o-=2){var l=2*Math.ceil(o/2);a.push(i+"."+e(l-1)+"~"+i+"."+e(l))}n=12}return a}var s=o,c=(a("034f"),a("2877")),u=Object(c["a"])(s,r,i,!1,null,null,null),f=u.exports,h=a("8c4f"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[null===t.tableData||0===t.tableData.length?a("el-card",[a("h1",[t._v("暂无目标")])]):t._e(),t._l(t.tableData,(function(e,n){return a("el-card",{staticClass:"box-card",staticStyle:{"margin-bottom":"10px"}},[a("span",{staticStyle:{float:"left",font:"bold 100% arial,sans-serif"}},[t._v("目标"+t._s(n+1)+": "+t._s(e.object))]),a("div",{staticStyle:{float:"right",padding:"5px 0"}},[a("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(e){return t.modifyObject(n)}}}),a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(e){return t.deleteTable(n)}}})],1),a("el-table",{staticStyle:{width:"100%","margin-top":"10px","margin-left":"10px"},attrs:{data:e.data,border:""},on:{"cell-dblclick":t.cellDbClick,"cell-mouse-leave":t.cellLeave}},[a("el-table-column",{attrs:{label:"关键结果","min-width":"35"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hitBox[e.row.object+e.row.index+e.column.label]?a("span",[a("el-input",{attrs:{type:"textarea",size:"small"},model:{value:e.row.key,callback:function(a){t.$set(e.row,"key",a)},expression:"scope.row.key"}})],1):a("span",[t._v(t._s(e.row.key))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"当前进度","min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hitBox[e.row.object+e.row.index+e.column.label]?a("span",[a("el-input-number",{attrs:{size:"small",max:e.row.target,min:0},model:{value:e.row.result,callback:function(a){t.$set(e.row,"result",a)},expression:"scope.row.result"}})],1):a("span",[t._v(t._s(e.row.result))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"目标值","min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hitBox[e.row.object+e.row.index+e.column.label]?a("span",[a("el-input",{attrs:{size:"small"},model:{value:e.row.target,callback:function(a){t.$set(e.row,"target",a)},expression:"scope.row.target"}})],1):a("span",[t._v(t._s(e.row.target))])]}}],null,!0)}),a("el-table-column",{attrs:{label:t.fixLabel,"min-width":"18"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.hitBox[e.row.object+e.row.index+e.column.label]?a("span",[a("el-input",{attrs:{size:"small"},model:{value:e.row.weight,callback:function(a){t.$set(e.row,"weight",a)},expression:"scope.row.weight"}})],1):!1===t.hitBox[e.row.object+e.row.index+e.column.label]?a("span",[a("el-input",{attrs:{size:"small",disabled:""},model:{value:e.row.weight,callback:function(a){t.$set(e.row,"weight",a)},expression:"scope.row.weight"}})],1):a("span",[t._v(t._s(e.row.weight))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"操作","min-width":"11"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(a){return t.deleteRow(e.row.object+e.row.key,n)}}})]}}],null,!0)})],1),a("el-col",[a("div",{staticClass:"el-table-add-row",staticStyle:{width:"99.2%"},on:{click:function(e){return t.preAddKey(n)}}},[a("span",[t._v("+ 添加")])])]),a("span",[t._v("当前总分："),a("b",[t._v(t._s(t.scoreList[n]))]),t._v(" (满分：100)")])],1)})),a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary"},on:{click:t.newObject}},[t._v("新建目标")]),a("el-dialog",{attrs:{title:"新建关键结果",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form}},[a("el-form-item",{attrs:{label:"关键结果",prop:"key",rules:[{required:!0,message:"关键结果不能为空"}]}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.key,callback:function(e){t.$set(t.form,"key",e)},expression:"form.key"}})],1),a("el-form-item",{attrs:{label:"目标值",prop:"target",rules:[{required:!0,message:"目标值不能为空"},{type:"number",message:"目标值必须为数字值"}]}},[a("el-input",{attrs:{autocomplete:"off"},model:{value:t.form.target,callback:function(e){t.$set(t.form,"target",t._n(e))},expression:"form.target"}})],1)],1),a("div",[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.addNewKey("form")}}},[t._v("确 定")])],1)],1)],2)},b=[],g=(a("4160"),a("a434"),a("b680"),a("d3b7"),a("ac1f"),a("25f0"),a("5319"),a("159b"),{data:function(){return{month:"",scoreList:[],hitBox:{},fixLabel:"占比(%)",form:{},editData:!1,dialogFormVisible:!1,tableData:[{object:"兴趣相关能力提升",data:[{index:"0",object:"兴趣相关能力提升",key:"出口仁大家的日本语剩余35课完成",result:10,target:35,weight:30},{index:"1",object:"兴趣相关能力提升",key:"OT web版发布",result:1,target:10,weight:60},{index:"2",object:"兴趣相关能力提升",key:"看完《百年孤独》",result:6,target:10,weight:10}]},{object:"兴趣相关能力提升2",data:[{index:"0",object:"兴趣相关能力提升2",key:"出口仁大家的日本语剩余35课完成",result:10,target:35,weight:30},{index:"1",object:"兴趣相关能力提升2",key:"OT web版发布",result:1,target:10,weight:40},{index:"2",object:"兴趣相关能力提升2",key:"看完《百年孤独》",result:6,target:10,weight:30}]}]}},methods:{initData:function(t){this.month=this.$route.query.month,this.tableData=[],this.scoreList=[],this.form={key:"",target:0,index:-1},this.dialogFormVisible=!1,t||(this.hitBox={},this.editData=!1);var e=localStorage.getItem(this.month);e=JSON.parse(e),e&&0!==e.length&&(this.tableData=e,this.preUpdate(e))},preUpdate:function(t){var e=this,a=[];t.forEach((function(t){var n=0;if(0!==t.data.length){t.data.forEach((function(t){n+=t.result/t.target*t.weight}));var r=t.data[t.data.length-1];e.hitBox[r.object+r.index+e.fixLabel]=!1}isNaN(n)&&(n=0),a.push(n.toFixed(2))})),this.scoreList=a},cellDbClick:function(t,e){var a=t.object+t.index+e.label;isNaN(this.hitBox[a])&&(this.hitBox[a]=!0,this.editData=!0,this.initData(!0))},cellLeave:function(t,e){this.editData&&(this.formatData(t,e)&&this.saveData(),this.initData())},saveData:function(){localStorage.setItem(this.month,JSON.stringify(this.tableData)),this.sendMsg("数据保存成功","success",1e3)},formatData:function(t,e){var a=localStorage.getItem(this.month);if(a===JSON.stringify(this.tableData))return!1;a=JSON.parse(a);for(var n=0;n<this.tableData.length;n++)for(var r=this.tableData[n].data,i=0;i<r.length;i++){var o=r[i];if("number"!==typeof o.target){if(parseInt(o.target).toString()!==o.target)return this.sendMsg("请输入整数","error",1500),!1;o.target=parseInt(o.target)}if("number"!==typeof o.weight){if(parseInt(o.weight).toString()!==o.weight)return this.sendMsg("请输入整数","error",1500),!1;o.weight=parseInt(o.weight)}if(o.target<o.result)return this.sendMsg("目标值不得小于当前进度","error",1500),!1;if(o.weight>100)return this.sendMsg("占比最高为100","error",1500),!1;if(e.label===this.fixLabel&&o.object===t.object&&o.key===t.key){var l=a[n].data.length-1,s=a[n].data[i].weight+a[n].data[l].weight;o.weight>s&&(o.weight=s),r[l].weight=s-o.weight}for(var c=0;c<r.length;c++){var u=r[c];if(c!==i&&u.key===o.key)return this.sendMsg("关键结果不能相同","error",1500),!1}}return!0},deleteRow:function(t){var e=this;this.$confirm("将要删除当前关键结果, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){for(var a=0;a<e.tableData.length;a++)for(var n=0;n<e.tableData[a].data.length;n++){var r=e.tableData[a].data,i=r[n];i.object+i.key===t&&(1!==r.length&&(n===r.length-1?r[r.length-2].weight+=r[n].weight:r[r.length-1].weight+=r[n].weight),r.splice(n,1))}e.saveData(),e.initData()})).catch(this.logMessage)},deleteTable:function(t){var e=this;this.$confirm("将要删除当前目标, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.tableData.splice(t,1),e.saveData(),e.initData()})).catch(this.logMessage)},modifyObject:function(t){var e=this;this.$prompt("原目标："+this.tableData[t].object,"修改目标",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(a){var n=a.value;e.isEmpty(n)?e.sendMsg("目标不能为空","error",1500):(e.tableData[t].object=n,e.tableData[t].data.forEach((function(t){t.object=n})),e.saveData(),e.initData())})).catch(this.logMessage)},newObject:function(){var t=this;this.$prompt("","新建目标",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(e){var a=e.value;if(t.isEmpty(a))t.sendMsg("目标不能为空","error",1500);else{for(var n=0;n<t.tableData.length;n++)if(t.tableData[n].object===a)return void t.sendMsg("已经设定过相同的目标","error",1500);t.tableData.push({object:a,data:[]}),t.saveData(),t.initData()}})).catch(this.logMessage)},preAddKey:function(t){this.dialogFormVisible=!0,this.form.index=t},addNewKey:function(t){var e=this;this.$refs[t].validate((function(t){if(!t)return e.sendMsg("未通过校验","error",1500),!1;if(e.dialogFormVisible=!1,e.isEmpty(e.form.key))e.sendMsg("关键结果不能为空","error",1500);else{for(var a=e.tableData[e.form.index].data,n=0;n<a.length;n++)if(a[n].key===e.form.key)return void e.sendMsg("关键结果不能相同","error",1500);var r=0;0===a.length&&(r=100),a.push({object:e.tableData[e.form.index].object,key:e.form.key,result:0,target:e.form.target,weight:r,index:a.length+""}),e.saveData(),e.initData()}}))},isEmpty:function(t){return null===t||0===t.replace(/ /g,"").length},sendMsg:function(t,e,a){this.$message({message:t,type:e,duration:a})},logMessage:function(t){console.log(t)}},created:function(){this.initData()},watch:{$route:"initData"}}),p=g,m=(a("cccb"),Object(c["a"])(p,d,b,!1,null,null,null)),v=m.exports;n["default"].use(h["a"]);var w=[{path:"/okr/*",name:"home",component:v}],y=new h["a"]({mode:"history",base:"/ot/",routes:w}),x=y,k=a("2f62");n["default"].use(k["a"]);var D=new k["a"].Store({state:{},mutations:{},actions:{},modules:{}}),j=a("5c96"),_=a.n(j);a("0fae");n["default"].use(_.a),n["default"].config.productionTip=!1,new n["default"]({router:x,store:D,render:function(t){return t(f)}}).$mount("#app")},"5ced":function(t,e,a){},"85ec":function(t,e,a){},cccb:function(t,e,a){"use strict";var n=a("5ced"),r=a.n(n);r.a}});
//# sourceMappingURL=app.edd04fab.js.map